/**
 * Made with ❤️ by Mighty — Maestro LLC
 * Copyright © 2025 Maestro LLC
 */(()=>{"use strict";function e(e,s,t,a){return new(t||(t=Promise))(function(n,i){function o(e){try{r(a.next(e))}catch(e){i(e)}}function d(e){try{r(a.throw(e))}catch(e){i(e)}}function r(e){var s;e.done?n(e.value):(s=e.value,s instanceof t?s:new t(function(e){e(s)})).then(o,d)}r((a=a.apply(e,s||[])).next())})}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;const s=["MIGHTY_INTERACTIVE_CORE_LOADED","MIGHTY_INTERACTIVE_HEIGHT_REPORT","MIGHTY_INTERACTIVE_POST_CORE_LOADED_REPORT","MIGHTY_INTERACTIVE_DIRECT_CODE_HTML_REQUESTED","MIGHTY_INTERACTIVE_DIRECT_CODE_HTML_REPORT","MIGHTY_INTERACTIVE_READY_TO_DISPLAY","MIGHTY_INTERACTIVE_COMPLETE","MIGHTY_INTERACTIVE_SCREENCAP","MIGHTY_INTERACTIVE_DYNAMIC_FORM_CONFIG","MIGHTY_INTERACTIVE_RELOAD_REQUESTED","MIGHTY_INTERACTIVE_SDK_HOST_PING","MIGHTY_INTERACTIVE_SDK_HOST_PONG","MIGHTY_INTERACTIVE_SDK_STATE_REQUESTED","MIGHTY_INTERACTIVE_SDK_STATE_PROVIDED","MIGHTY_INTERACTIVE_ERROR","MIGHTY_INTERACTIVE_SDK_MESSAGE_TO_HOST","MIGHTY_INTERACTIVE_SDK_MESSAGE_FROM_HOST","MIGHTY_INTERACTIVE_SDK_TRACKING_REQUEST","MIGHTY_INTERACTIVE_SDK_TRACKING_RESPONSE"];function t(e){return"object"==typeof e&&null!==e&&"object"==typeof e.data&&null!==e.data&&s.includes(e.data.type)}const a="MIGHTY_TRACKING_GET_STATUS",n="MIGHTY_TRACKING_UPSERT_INTERACTION",i="MIGHTY_TRACKING_GET_INTERACTIONS",o="MIGHTY_TRACKING_GET_LEARNER",d="MIGHTY_TRACKING_SCORM2004_SET_VALUE",r="MIGHTY_TRACKING_SCORM2004_GET_VALUE",c="MIGHTY_TRACKING_XAPI_SEND_STATEMENT",T="MIGHTY_TRACKING_XAPI_GET_STATEMENTS",I="MIGHTY_TRACKING_XAPI_VOID_STATEMENT",l="MIGHTY_TRACKING_XAPI_GET_ACTOR";class E{constructor(e,s){this.sendMessage=e,this.getBlockId=s,this.isAvailable=!1,this.scorm2004=new _(e,s),this.xapi=new h(e,s)}initialize(){const e=new Promise(e=>{this.sendMessage({messageType:a,payload:{blockId:this.getBlockId()},callback:s=>{s&&(this.isAvailable=s.isAvailable,this.standard=s.standard),e()}})}),s=new Promise(e=>setTimeout(()=>{this.isAvailable=!1,this.standard=void 0,e()},100));return Promise.race([e,s])}upsertInteraction(e){return new Promise(s=>{this.sendMessage({messageType:n,payload:Object.assign({blockId:this.getBlockId()},e),callback:()=>{s()}})})}getInteractions(e){return new Promise(s=>{this.sendMessage({messageType:i,payload:{blockId:this.getBlockId(),filter:e},callback:e=>{s(e)}})})}getLearner(){return new Promise(e=>{this.sendMessage({messageType:o,payload:{blockId:this.getBlockId()},callback:s=>{e(s)}})})}}class _{constructor(e,s){this.sendMessage=e,this.getBlockId=s}setValue(e,s){return new Promise(t=>{this.sendMessage({messageType:d,payload:{blockId:this.getBlockId(),key:e,value:s},callback:()=>{t()}})})}getValue(e){return new Promise(s=>{this.sendMessage({messageType:r,payload:{blockId:this.getBlockId(),key:e},callback:e=>{s(null!=e?e:"")}})})}}class h{constructor(e,s){this.sendMessage=e,this.getBlockId=s}sendStatement(e){return new Promise(s=>{this.sendMessage({messageType:c,payload:{blockId:this.getBlockId(),statement:e},callback:()=>{s()}})})}getStatements(e){return new Promise(s=>{this.sendMessage({messageType:T,payload:{blockId:this.getBlockId(),params:e},callback:e=>{s(e)}})})}voidStatement(e){return new Promise(s=>{this.sendMessage({messageType:I,payload:{blockId:this.getBlockId(),statementId:e},callback:()=>{s()}})})}getActor(){return new Promise(e=>{this.sendMessage({messageType:l,payload:{blockId:this.getBlockId()},callback:s=>{e(s)}})})}}class g{constructor(){this.messageHandlers=new Map,this.customMessageHandlers=new Map,this.pendingCallbacks=new Map,this.requestIdCounter=0,this.listenToPostMessagesRelatedToSDK()}generateRequestId(){return`req_${Date.now()}_${++this.requestIdCounter}`}onMessageReceived(e,s){var t;return this.messageHandlers.has(e)||this.messageHandlers.set(e,new Set),null===(t=this.messageHandlers.get(e))||void 0===t||t.add(s),()=>{var t;null===(t=this.messageHandlers.get(e))||void 0===t||t.delete(s)}}sendHostPingMessage(){this.postMessageToInteractiveBlockWindow({type:"MIGHTY_INTERACTIVE_SDK_HOST_PING"})}sendStateRequestedMessage(e){this.postMessageToInteractiveBlockWindow({type:"MIGHTY_INTERACTIVE_SDK_STATE_REQUESTED",data:{defaultState:e}})}sendMarkAsCompleteMessage(){this.postMessageToInteractiveBlockWindow({type:"MIGHTY_INTERACTIVE_COMPLETE"})}sendMessageToHost(e){const s=e.callback?this.generateRequestId():void 0;s&&e.callback&&this.pendingCallbacks.set(s,e.callback),this.postMessageToInteractiveBlockWindow({type:"MIGHTY_INTERACTIVE_SDK_MESSAGE_TO_HOST",data:{messageType:e.messageType,payload:e.payload,requestId:s}})}sendTrackingMessage(e){const s=e.callback?this.generateRequestId():void 0;s&&e.callback&&this.pendingCallbacks.set(s,e.callback),this.postMessageToInteractiveBlockWindow({type:"MIGHTY_INTERACTIVE_SDK_TRACKING_REQUEST",data:{messageType:e.messageType,payload:e.payload,requestId:s}})}onMessageFromHost(e){var s;const{messageType:t,callback:a}=e;return this.customMessageHandlers.has(t)||this.customMessageHandlers.set(t,new Set),null===(s=this.customMessageHandlers.get(t))||void 0===s||s.add(a),()=>{var e;null===(e=this.customMessageHandlers.get(t))||void 0===e||e.delete(a)}}listenToPostMessagesRelatedToSDK(){window.addEventListener("message",e=>{if(t(e)){const s=e.data.type;switch(s){case"MIGHTY_INTERACTIVE_SDK_HOST_PONG":this.handleMessageReceived(s,e.data.data);break;case"MIGHTY_INTERACTIVE_SDK_STATE_PROVIDED":this.handleMessageReceived(s,e.data.data.state);break;case"MIGHTY_INTERACTIVE_SDK_MESSAGE_FROM_HOST":e.data.data.requestId?this.handleResponseCallback(e.data.data.requestId,e.data.data.payload):this.handleCustomMessageFromHost(e.data.data.messageType,e.data.data.payload);break;case"MIGHTY_INTERACTIVE_SDK_TRACKING_RESPONSE":e.data.data.requestId&&this.handleResponseCallback(e.data.data.requestId,e.data.data.payload)}}})}postMessageToInteractiveBlockWindow(e){window.parent!==window&&window.parent.postMessage(e,"*")}handleMessageReceived(e,s){const t=this.messageHandlers.get(e);t&&t.forEach(e=>{e(null!=s?s:void 0)})}handleCustomMessageFromHost(e,s){const t=this.customMessageHandlers.get(e);t&&t.forEach(e=>{e(s)})}handleResponseCallback(e,s){const t=this.pendingCallbacks.get(e);t&&(t(s),this.pendingCallbacks.delete(e))}}class M{getState(e,s){return Promise.resolve(e)}}class R{constructor(e){this.messenger=e}getState(s){return e(this,void 0,void 0,function*(){return new Promise((e,t)=>{const a=setTimeout(()=>{t(new Error("Interactive state not provided in time"))},5e3);this.messenger.onMessageReceived("MIGHTY_INTERACTIVE_SDK_STATE_PROVIDED",s=>{clearTimeout(a),e(s)}),this.messenger.sendStateRequestedMessage(s)})})}}const p=new class{constructor(){this.version="1.1.1",this.sdkIsReady=!1,this.sdkReadyCallbacks=[],this.messenger=new g,this.useNoOpMode=!1}initialize(){return e(this,void 0,void 0,function*(){(yield this.checkForHost())||(this.useNoOpMode=!0),this.useNoOpMode?this.state=new M:this.state=new R(this.messenger),this.tracking=new E(e=>this.messenger.sendTrackingMessage(e),()=>this.blockId),this.useNoOpMode||(yield this.tracking.initialize()),this.sdkIsReady=!0;for(const e of this.sdkReadyCallbacks)e()})}onSdkReady(e){this.sdkReadyCallbacks.push(e),this.sdkIsReady&&e()}markAsComplete(){this.messenger.sendMarkAsCompleteMessage()}sendMessageToHost(e){this.messenger.sendMessageToHost(e)}onMessageFromHost(e){return this.messenger.onMessageFromHost(e)}checkForHost(){return window.parent===window?Promise.resolve(!1):new Promise(e=>{let s=!1;const t=()=>{s=!0,clearInterval(a),clearTimeout(n)};this.messenger.onMessageReceived("MIGHTY_INTERACTIVE_SDK_HOST_PONG",a=>{s||(t(),a&&(a.courseId&&(this.courseId=a.courseId),a.blockId&&(this.blockId=a.blockId),void 0!==a.isCompleted&&(this.isCompleted=a.isCompleted),this.hostViewMode=a.hostViewMode),e(!0))}),this.messenger.sendHostPingMessage();const a=setInterval(()=>{s||this.messenger.sendHostPingMessage()},100),n=setTimeout(()=>{s||(t(),e(!1))},5e3)})}};window.mightyInteractiveSdk=p,p.initialize();(new class{initialize(){this.postMessageToParentWindow({type:"MIGHTY_INTERACTIVE_CORE_LOADED"}),this.listenForWhenDocumentIsReady(),this.listenForMessagesFromParent()}listenForWhenDocumentIsReady(){this.onDocumentReady()}onDocumentReady(){this.listenForWhenDocumentIsResized()}listenForWhenDocumentIsResized(){this.postMightyInteractiveHeightReport(),new ResizeObserver(()=>{this.postMightyInteractiveHeightReport()}).observe(document.documentElement)}postMightyInteractiveHeightReport(){const e=document.documentElement.getBoundingClientRect().height;this.postMessageToParentWindow({type:"MIGHTY_INTERACTIVE_HEIGHT_REPORT",data:{height:Math.ceil(e)}})}postMessageToParentWindow(e){window.parent.postMessage(e,"*")}listenForMessagesFromParent(){window.addEventListener("message",e=>{if(!t(e))return;const s=e.data;switch(s.type){case"MIGHTY_INTERACTIVE_SCREENCAP":this.onMightyInteractiveScreencapMessage(s);break;case"MIGHTY_INTERACTIVE_POST_CORE_LOADED_REPORT":this.onMightyInteractivePostCoreLoadedReportMessage(s)}})}onMightyInteractiveScreencapMessage(e){if("MIGHTY_INTERACTIVE_SCREENCAP"===e.type){const s=e.data.html,t=(new window.DOMParser).parseFromString(s,"text/html");document.replaceChild(t.documentElement,document.documentElement)}}onMightyInteractivePostCoreLoadedReportMessage(e){if("MIGHTY_INTERACTIVE_POST_CORE_LOADED_REPORT"===e.type){const{injectCss:s,injectJavascript:t}=e.data;this.injectCssAndJavascriptSnippets({cssSnippet:s,javascriptSnippet:t}),this.postMessageToParentWindow({type:"MIGHTY_INTERACTIVE_READY_TO_DISPLAY"})}}injectCssAndJavascriptSnippets(s){return e(this,void 0,void 0,function*(){var e,t;const{cssSnippet:a,javascriptSnippet:n}=s;if(void 0!==a&&(null===(e=document.querySelector("#mightyInteractiveOverrideCss"))||void 0===e||e.remove(),a)){const e=document.createElement("style");e.id="mightyInteractiveOverrideCss",e.innerHTML=a;(yield this.waitForBody()).appendChild(e)}if(void 0!==n&&(null===(t=document.querySelector("#mightyInteractiveOverrideJavascript"))||void 0===t||t.remove(),n)){const e=document.createElement("script");e.id="mightyInteractiveOverrideJavascript",e.innerHTML=n;(yield this.waitForBody()).appendChild(e)}})}waitForBody(){return document.body?Promise.resolve(document.body):new Promise(e=>{const s=new MutationObserver(()=>{document.body&&(s.disconnect(),e(document.body))});s.observe(document.documentElement,{childList:!0})})}}).initialize()})();